<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="replyMapper">

	<resultMap type="Reply" id="reply_rm">
		<id property="replyNo" column="REPLY_NO"/>
		
		<result property="replyContent" column="REPLY_CONTENT"/>
		<result property="replyCreateDt" column="REPLY_CREATE_DT"/>
		<result property="replyStatus" column="REPLY_STATUS"/>
		<result property="replyDepth" column="REPLY_DEPTH"/>
		<result property="parentFriendNo" column="PARENT_FRIEND_NO"/>
		<result property="memNo" column="MEM_NO"/>
		<result property="parentReplyNo" column="PARENT_REPLY_NO"/>
	 
	</resultMap>
	
	<!-- 댓글 목록 조회 -->
	<select id="selectReplyList" parameterType="_int" resultMap="reply_rm">
		SELECT * FROM FRIEND_REPLY
		WHERE REPLY_STATUS = 'Y'
		AND PARENT_FRIEND_NO = #{parentFriendNo}
		AND PARENT_REPLY_NO IN (SELECT REPLY_NO FROM REPLY
								WHERE REPLY_STATUS = 'Y')
								AND REPLY_DEPTH = 0
								AND PARENT_FRIEND_NO = #{parentFriendNo})
		ORDER BY PARENT_REPLY_NO DESC,
				CASE WHEN PARENT_REPLY_NO = REPLY_NO THEN 99999999
				ELSE REPLY_NO END DESC
	</select>
	
	

</mapper>